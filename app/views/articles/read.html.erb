
<% current_magazine = @article.magazine %>

<% content_for :head do %>

    <title><%= @article.headline %></title>
    <%= stylesheet_link_tag(current_magazine.magtemplate.path) %>
    <link rel="resources" href="/resources.html"/>
    <link rel="index" href="<%= url_for(content_index_magazine_path(current_magazine)) %>" type="application/json"/>
    <%= javascript_include_tag("treesaver-0.10.0-debug") %>

<% end %>


<!--
 <p>Reading
 <%#= current_magazine.name
%>, volume <%#= current_magazine.volume
 %>,
  No <%#= current_magazine.number
   %>, <%#= current_magazine.date
    %></p>
     -->
<% content_for :treesaver do %>
<article data-grids="<%= @article.grid.name %>">
    <figure>
      <h2 data-sizes="title fallback">
        <span class="chapter"><%= @article.title %></span>
        <%= @article.headline %>
      </h2>
    </figure>

  <p> <%= @article.text.html_safe %></p>




  <% @article.assets.each do |asset|%>

      <figure class="zoomable">

        <div hidden class="hidden" data-sizes="single" data-minWidth="279">
          <img data-src= <%=asset.asset.url(:single280).to_s%> />
          <p class="caption">Test Single!</p>
        </div>
        <div hidden class="hidden" data-sizes="double"  data-minWidth="579">
          <img data-src=<%=asset.asset.url(:double280).to_s%> />
          <p class="caption">Test Double!</p>
        </div>

        <div hidden class="hidden" data-sizes="fallback"  data-minWidth="49">
          <p>On fallback!!!!!</p>
          <img data-src=<%=asset.asset.url(:thumb).to_s%> />
          <p class="caption">Test Thumb!</p>
        </div>


      </figure>




     <%end%>


  <!-- Naoufal: experimental: embedding YouTube video links ---------------- -->

  <% unless @article.videolinks.blank? or @article.grid.containers.blank? %>
      <% embedded_videolinks = @article.videolinks.where(:embedded => true) %>
      <% video_containers = @article.grid.containers.where(:video => true) %>

      <% embedded_videolinks.each do |v| %>
          <figure>
            <% video_containers.each do |c| %>
                <% video_width = c.width.sizes.find {
                        |s| s.magtemplate.id == current_magazine.magtemplate.id }.value %>
                <%= v.videolink_html_code(video_width, c.data_sizes.sub('title ', '')) %>
            <% end %>
          </figure>

      <% end %>
      <%# (0..embedded_videolinks.length-1).each do |i|
       %>
          <%#=embedded_videolinks[i].videolink_html_code(video_containers[(i % video_containers.length)], current_magazine)
              %>
      <%# end
      %>


  <% end %>
  <!-- --------------------------------------- -->
</article>
<% end %>
